<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>NoxiaPro</title>
<link href="styles/main.css" rel="stylesheet" type="text/css">
<link href="styles/main.css" rel="stylesheet" type="text/css">
<link href="styles/main.css" rel="stylesheet" type="text/css">
<!--The following script tag downloads a font from the Adobe Edge Web Fonts server for use within the web page. We recommend that you do not modify it.--><script>var __adobewebfontsappname__="dreamweaver"</script><script src="http://use.edgefonts.net/poiret-one:n4:default;poly:n4:default.js" type="text/javascript"></script>
</head>

<body>
<div id="wrapper">
  <header id="top">
    <h1>Noxia Pro</h1>
    <nav id="mainnav">
      <ul>
        <li><a href="home.html">Home</a></li>
        <li><a href="graph-check.psp">graph-check</a></li>
        <li class="thispage"><a href="toxic-substances.psp?Organism=&Substance=" class="thispage">substances</a></li>
        <li><a href="faq.html">faq</a></li>
        <li><a href="#">contact</a></li>
      </ul>
    </nav>
    <article>Database</article>
	<!-- ######### -->
	<div id="page">
		<div id="page-bgtop">
			<div id="page-bgbtm">
				<div id="page-content">
					<div id="content">
						<div class="post">
							<h2 class="title"><a href="#">Substances</a></h2>

								<p> Found substances, press submit once for all the results
							<div class="entry">
								

								<table id="rounded-corner" summary="2007 Major IT Companies' Profit">
								    <thead>
								    	<tr>
								        	<th scope="col" class="rounded-company">pubmed_ID</th>
								            <th scope="col" class="rounded-q1">author</th>
								            <th scope="col" class="rounded-q2">date</th>
								            <th scope="col" class="rounded-q4">titel</th>
											<th scope="col" class="rounded-q4">abstract</th>
								        </tr>
								    </thead>
								        <tfoot>
								    	<tr>
								        	<td colspan="4" class="rounded-foot-left"><em>Results</em></td>
								        	<td class="rounded-foot-right">&nbsp;</td>
								        </tr>
								    </tfoot>
								    <tbody>
<%
import sys
sys.path.append('/home/bi2_pg4/public_html/NoxiaPro/')
import app
from Bio import Entrez
from Bio import Medline
substance = form["Substance"]
organism = form["Organism"]
%>
<%

import MySQLdb as con

form.has_key('Substance'and'Organism')
TERM1 = '%s' %form['Substance']
TERM2 = '%s'%form['Organism']
TERMS = ('(' +TERM1 + ')' + 'AND'+ '('+TERM2 + ')')

Entrez.email = "A.N.Other@example.com"     # Always tell NCBI who you are
handle = Entrez.egquery(term=TERMS)
record = Entrez.read(handle)
for row in record["eGQueryResult"]:
	 if row["DbName"]=="pubmed":
		  print(row["Count"])
		 
handle = Entrez.esearch(db="pubmed", term=TERMS, retmax=463)
record = Entrez.read(handle)

handle = Entrez.efetch(db="pubmed", id=record["IdList"], rettype="medline")
records = Medline.parse(handle)
records = list(records)

for record in records:
	title= record.get("TI", "?")
	authors= record.get("AU", "?")
	source= record.get("SO", "?")
	abstract= record.get("AB", "?")
	date= record.get("DA", "?")
	 

# Open database connection
dataB=con.connect(host="localhost", # your host, usually localhost
user="bi2_pg4", # your username
passwd="blaat1234", # your password
db="bi2_pg4") # name of the data base

# prepare a cursor object using cursor() method
cursor1 = dataB.cursor()
cursor2 = dataB.cursor()
cursor3 = dataB.cursor()
	
# Prepare SQL query to UPDATE required records
stat1 = (INSERT INTO substances(substance) VALUES (TERM1))
stat2 = (INSERT INTO organisms (organisms) VALUES (TERM2))
stat3 = (INSERT INTO publications (pubmed_id, title, authors, magazine, year, abstract) VALUES (001, 'title', ',' join.authors(), 'source', 'date', 'abstract'))

if (("SELECT * FROM organisms WHERE Key =(%s) ", (TERM2)), cursor2) and (("SELECT * FROM organisms WHERE Key =(%s) ", (TERM1)),cursor2):
	 print ('Zit al in de database')
else:
	 print ('Zit nog niet in de database.')
	 try:
	   # Execute the SQL command
		  cursor1.execute(stat1)
		  cursor2.execute(stat2)
		  cursor3.execute(stat3)

	   # Commit your changes in the database
		  dataB.commit()

	 except pymysql.Error:
		  print ("ERROR IN CONNECTION")
	 except:
	   # Rollback in case there is any error
		  dataB.rollback()
# disconnect from server
cursor1.close()
cursor2.close()
cursor3.close()
dataB.close()
%>
<%=app.index(organism, substance)%>
								    </tbody>
								</table>
								</p>
							</div>
						</div>
						<div style="clear: both;">&nbsp;</div>
					</div>
					<!-- end #content -->
					<div id="sidebar">
						<ul>
							<li>
								<h2>How to</h2>
								<p>In section parameters below this you must add your parameters to find proteïns.
								 	In case of no results change your parameters.</p>
							</li>
							<li>
								<h2>Parameters</h2>
								<ul>
									<li>
										<form 
										action="toxic-substances.psp" method="post">
										Substance: <input type="text" name="Substance" value="">
										Organism: <input type="text" name="Organism" value="">
										<input type="submit" value="Submit">
										</form>
									</li>
								</ul>
							</li>
						</ul>
					</div>
					<!-- end #sidebar -->
				</div>
				<div style="clear: both;">&nbsp;</div>
			</div>
		</div>
	</div>
	<!-- ######### -->
  </header>
  

 
  <footer>©h4X0rs</footer>
</div>
</body>
</html>
